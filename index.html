<!DOCTYPE html>
<html lang="en">

<head>
	<title>Minesweeper</title>
	<link rel="stylesheet" href="styles.css">
	<link rel="stylesheet" href="fonts/font-awesome-4.4.0/css/font-awesome.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="minesweeper.js"></script>
	<script>
		$(document).ready(function() {
			
			var model;
			var view;
			var controller;
			
			function init(options) {
				var width = options.width;
				var height = options.height;
				var mines = options.mines;
				
				model = new GridModel(width, height, mines);
				view = new MinesweeperView(model, { 'grid' : $('#grid') });
				controller = new MinesweeperController(model, view);

				$("#gameOptions").hide();
				view.render();
				$("#grid").show();
			}
			
			$("#grid").hide();
			
			// Events
			// Start game button clicked
			$('#startGameButton').on('click', function () {				
				init({
					width: $('#width').val(),
					height: $('#height').val(),
					mines: $('#mineCount').val()
				});
			});
			
			// Left mouse click on grid cell
			$(document).on("click", ".gridCell", function (event) {
				var leftClickOnGridCellEvent = new CustomEvent("leftClickOnGridCellEvent", {
					detail: { x: event.target.dataset.x, y: event.target.dataset.y } 
				});
				document.dispatchEvent(leftClickOnGridCellEvent);
			});
			
			// Right mouse click on grid cell
			$(document).on("contextmenu", ".gridCell", function(event) {
				// Stops context menu from appearing
				event.preventDefault(); 
				var rightClickOnGridCellEvent = new CustomEvent("rightClickOnGridCellEvent", { 
					detail: { x: event.target.dataset.x, y: event.target.dataset.y } 
				});
				document.dispatchEvent(rightClickOnGridCellEvent);
			});
			
			// Game difficulty changed
			$("#gameDifficulty").on("change", function (event) {
				var gameDifficultySelect = document.getElementById("gameDifficulty");
				var difficulty = gameDifficultySelect.options[gameDifficultySelect.selectedIndex].value;
				
				// TODO: Make input text fields editable only when custom is selected.
				switch(difficulty) {
					case "Beginner":
						$('#width').val("9");
						$('#height').val("9");
						$('#mineCount').val("10");
						break;
					case "Intermediate":
						$('#width').val("16");
						$('#height').val("16");
						$('#mineCount').val("40");
						break;
					case "Advanced":
						$('#width').val("30");
						$('#height').val("16");
						$('#mineCount').val("99");
						break;
					case "Custom":
						$('#width').val("30");
						$('#height').val("16");
						$('#mineCount').val("99");
						break;
				}
			});
			
			// Listeners
			// Left mouse click on grid cell
			document.addEventListener("leftClickOnGridCellEvent", function (event) {
				controller.leftClickOnGridCell(event.detail.x, event.detail.y);
			});
			
			// Right mouse click on grid cell
			document.addEventListener("rightClickOnGridCellEvent", function (event) {
				controller.rightClickOnGridCell(event.detail.x, event.detail.y);
			});
		});
	</script>
</head>
<body>
	<div id="gridContainer">
		<div id="gameOptions">

			<div class="gameOption">
				<div class="gameOptionLabel">Difficulty</div>
				<select id="gameDifficulty" class="gameOptionInput">
					<option value="Beginner">Beginner</option>
					<option value="Intermediate">Intermediate</option>
					<option value="Advanced">Advanced</option>
					<option value="Custom">Custom</option>
				</select>
			</div>

			<div class="gameOption">
				<div class="gameOptionLabel">Grid Width</div>
				<input id="width" type="text" name="width" value="9" size="1" class="gameOptionInput">
			</div>
			
			<div class="gameOption">
				<div class="gameOptionLabel">Grid Height</div>
				<input id="height" type="text" name="height" value="9" size="1" class="gameOptionInput">
			</div>

			<div class="gameOption">
				<div class="gameOptionLabel">Mines</div>
				<input id="mineCount" type="text" name="mineCount" value="9" size="1" class="gameOptionInput">
			</div>
			
			<div class="gameOption">
				<input id="startGameButton" type="submit" value="Start Game!">
			</div>
						
		</div>
		
		<div id="grid"/>
	</div>
</body>

</html>